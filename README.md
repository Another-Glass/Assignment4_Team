<div align="center">

  # 원티드 백엔드 프리온보딩 4차 과제 - 8퍼센트

  <img height="400" width="700" src="https://user-images.githubusercontent.com/59385491/139865333-05dabf0a-e283-4e51-94d9-8a42e6acbb7b.jpeg">


  <h2> 👨‍💻 원티드 프리온보딩 어나더글라스 팀입니다. </h2>

<p>6명의 안경잡이 개발자들의 시선과 관점이 담긴 과제입니다.</p>
<p>무던히 포기하지 않고 견디고 견뎠던 그 시간들이 변함없는 단 하나의 해답임을 믿습니다.</p>

</div>


<div align=center>

<img alt="PRs Welcome" src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square" />
<img alt="Hits" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2FAnother-Glass%2FAssignment1_Team1%2Fblob%2Fdevelop%2FREADME.md&count_bg=%2379C83D&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=false" />
<img alt="issues" src="https://img.shields.io/github/issues/Another-Glass/Assignment1_Team1" />


</div>

</br>
</br>
</br>
</br>
</br>
</br>

## 🎤 소개

이 레포지토리는 [원티드 프리온보딩 백엔드 코스](https://www.wanted.co.kr/events/pre_onboarding_course_4) 4차 과제를 위해 만들어졌습니다. 

-   일정 : 2021년 11월 11일(목) 오후 6시 ~ 11월 13일(토) 오전 10시

<br>
<br>

<div align='center'>

## 🧑🏻‍💻 팀원 소개

| **팀장 박상수** | **팀원 김성연** | **팀원 최준호** |
|:-----:|:-----:|:-----: |
|  <img src="https://avatars.githubusercontent.com/u/59385491?v=4" height=200 width=200> | <img src="https://avatars.githubusercontent.com/u/38933716?v=4" height=200 width=200> |<img src="https://avatars.githubusercontent.com/u/67402180?v=4" height=200 width=200>  |
| **blog**: [Plus Ultra](https://overcome-the-limits.tistory.com/) </br> **github**: [epitone](https://github.com/epitoneproject)| **blog**: [sudocorp](https://sudocorp.tistory.com/) </br> **github**: [SibaDoge1](https://github.com/SibaDoge1)| **blog**: [raejun92.log](https://velog.io/@raejun92) </br> **github**: [raejun92](https://github.com/raejun92)
| ![sprint4](https://img.shields.io/badge/wanted-sprint4-purple) |![sprint4](https://img.shields.io/badge/wanted-sprint4-purple)  | ![sprint4](https://img.shields.io/badge/wanted-sprint3-purple) |
| 유저 & 계좌생성 API, DB / Test   | 입출금 API, DB / DevOps | 거래내역 API, DB |
| [프로젝트 회고](https://overcome-the-limits.tistory.com/entry/%ED%9A%8C%EA%B3%A0-%EC%9B%90%ED%8B%B0%EB%93%9C-%ED%94%84%EB%A6%AC%EC%98%A8%EB%B3%B4%EB%94%A9-%EB%B0%B1%EC%97%94%EB%93%9C-%EC%BD%94%EC%8A%A4-3%EC%B0%A8-%EA%B3%BC%EC%A0%9C?category=980007) | [프로젝트 회고](https://sudocorp.tistory.com/4) | [프로젝트 회고]()

<br>
<br>

|                       **팀원 어유선**                        |                       **팀원 김현길**                        |                       **팀원 이동훈**                        |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src="https://avatars.githubusercontent.com/u/32833404?v=4" height=200 width=200> | <img src="https://avatars.githubusercontent.com/u/48472537?v=4" height=200 width=200> | <img src="https://avatars.githubusercontent.com/u/68373235?v=4" height=200 width=200> |
| **blog**: [Makkiato](https://makkiato.tistory.com) </br> **github**: [Makkiato](https://github.com/Makkiato) | **blog**: [gusrlf14](https://velog.io/@gusrlf14) </br> **github**: [hyunghilkim](https://github.com/hyunghilkim) | **blog**: [dongjay00.log](https://velog.io/@dongjay00) </br> **github**: [dongjay00](https://github.com/dongjay00) |
| ![sprint4](https://img.shields.io/badge/wanted-sprint4-purple) | ![sprint4](https://img.shields.io/badge/wanted-sprint4-purple) | ![sprint4](https://img.shields.io/badge/wanted-sprint4-purple) |
|                    거래내역 API, DB                      |                             입출금 API, DB                              |                              유저 & 계좌생성 API, DB / Test                              |
|                      [프로젝트 회고]()                       |                      [프로젝트 회고]()                       | [프로젝트 회고]() |


</div>

<br>
<br>
<br>

## 📕 과제 내용

### [필수 포함 사항]

- READ.ME 작성
    - 프로젝트 빌드, 자세한 실행 방법 명시
    - 구현 방법과 이유에 대한 간략한 설명
    - 완료된 시스템이 배포된 서버의 주소
    - Swagger나 Postman을 통한 API 테스트할때 필요한 상세 방법
    - 해당 과제를 진행하면서 회고 내용 블로그 포스팅
- Swagger나 Postman을 이용하여 API 테스트 가능하도록 구현

</br>


### [개발 요구사항]

**✔️ API 목록**
- 거래내역 조회 API
- 입금 API
- 출금 API


<details><summary>[고려 사항]</summary>
  **✔️ 주요 고려 사항은 다음과 같습니다.**

---

- 계좌의 잔액을 별도로 관리해야 하며, 계좌의 잔액과 거래내역의 잔액의 무결성의 보장
- DB를 설계 할때 각 칼럼의 타입과 제약

**✔️ 구현하지 않아도 되는 부분은 다음과 같습니다.**

---

- 문제와 관련되지 않은 부가적인 정보. 예를 들어 사용자 테이블의 이메일, 주소, 성별 등
- 프론트앤드 관련 부분

**✔️  제약사항은 다음과 같습니다.**

---

- (**8퍼센트가 직접 로컬에서 실행하여 테스트를 원하는 경우를 위해**) 테스트의 편의성을 위해 mysql, postgresql 대신 sqllite를 사용해 주세요.
</div>
</details>

<br>

**✔️  상세설명**

**1)** 거래내역 조회 **API**

- 아래와 같은 조회 화면에서 사용되는 API를 고려하시면 됩니다.
    <img src="https://lh6.googleusercontent.com/PdtI4YvVu3biJ0TyEGCHVrR0fAPOQsILYHEczQHmR3UMKEINxlIjjp_-3gOGu5yGh3YXpxbegNYqNCEosUosq3nKRTMpte6ZiRUccX8iRlD5rxLJ1HWFy6E2HcMFMIMGZO7eVQl5" height=400 width=600>
   
    

거래내역 API는 다음을 만족해야 합니다.

- 계좌의 소유주만 요청 할 수 있어야 합니다.
- 거래일시에 대한 필터링이 가능해야 합니다.
- 출금, 입금만 선택해서 필터링을 할 수 있어야 합니다.
- Pagination이 필요 합니다.
- 다음 사항이 응답에 포함되어야 합니다.
    - 거래일시
    - 거래금액
    - 잔액
    - 거래종류 (출금/입금)
    - 적요

---

**2)** 입금 **API**

입금 API는 다음을 만족해야 합니다.

- 계좌의 소유주만 요청 할 수 있어야 합니다.

---

**3)** 출금 **API**

출금 API는 다음을 만족해야 합니다.

- 계좌의 소유주만 요청 할 수 있어야 합니다.
- 계좌의 잔액내에서만 출금 할 수 있어야 합니다. 잔액을 넘어선 출금 요청에 대해서는 적절한 에러처리가 되어야 합니다.

---

**4)** 가산점

다음의 경우 가산점이 있습니다.

- Unit test의 구현
- Functional Test 의 구현 (입금, 조회, 출금에 대한 시나리오 테스트)
- 거래내역이 1억건을 넘어갈 때에 대한 고려
    - 이를 고려하여 어떤 설계를 추가하셨는지를 README에 남겨 주세요.


</br>
</br>

## 📕 작업 효율 개선 방안

- Node.js, express, MongoDB, Mongoose, socket.io를 활용해서 CRUD API, 회원가입 로그인 API, 프로젝트 API, 퍼블리싱 API, 실시간 이벤트 처리를 구현했습니다.
- 인증, 인가를 위해 세션, 쿠키를 활용했습니다.
- 코드 컨벤션, 커밋 컨벤션, Git Flow를 지켜가며 작업했습니다.
- Github Project, 마일스톤을 활용해서 백로그, 이슈 관리를 진행했습니다.
- 계층 분리를 통해 코드의 가독성을 높였습니다.
- 리팩토링을 통해 가독성을 높이고, 유지보수를 편하게 하기 위해 노력 했습니다.

</br>
</br>

## 💡 구현 기능

### [ 회원가입, 로그인 ]

- 인증방식은 JWT를 쿠키에 저장하는 방식으로 구현 하였습니다.

<br>

### [ 계좌생성 API ]

- 계좌생성에 대한 이야기 작성

<br>

### [ 입출금 API ]

- 입출금 API 작성

<br>


### [ 거래내역 조회 API ]

- 거래 내역 API 작성


<br>

### [ 에러 핸들링 ]

- 자바스크립트 자체 내장 Error 클래스를 상속 받아서, 커스텀 에러를 생성해서 관리했습니다.


<br>
<br>

## 📕 __실시간 저장 성능을 위한 구현방안__
- 처음에는 일정 시간 단위로 단순히 데이터를 보내는 것을 생각했지만, 단위가 길어지면 실시간 저장이 힘들고 짧아지면 너무 빈번한 저장으로 성능에 좋지 않다고 생각했습니다.
- 그렇다고 사용자가 데이터를 변경할 때마다 요청한다면 1초에 수십번의 요청 및 쿼리실행이 될 것이라 생각하여 개선방안을 생각해보았습니다.
  
  <img src="https://user-images.githubusercontent.com/38933716/140969497-f238b28d-d89b-49d0-8de7-f0ab8ee909fd.png" width="600" height="400"/>

  <img src="https://user-images.githubusercontent.com/38933716/140969491-e555e2ad-6acd-4e56-a402-fdd1f594c24d.png" width="300" height="400"/>

  ##### 간단한 코드입력에도 수십번의 저장을 시도하는 모습

<br>

- 1차적으로, 서버에 버퍼를 두는 방식을 생각했습니다. 클라이언트가 저장요청을 보내면 서버는 해당 데이터를 버퍼에 임시보관하고, 일정 시간 뒤 버퍼의 최신 데이터를 DB에 저장하도록 했습니다.

  <img src="https://user-images.githubusercontent.com/38933716/140970465-5e865ad2-aff2-4e55-81f2-38bc1c8560b6.png" width="450" height="300"/>
  
  ##### 받아온 정보를 버퍼에 저장하는 부분 

  <br>

  <img src="https://user-images.githubusercontent.com/38933716/140970472-d10a34cc-4925-457a-a8aa-e8fb738bfb03.png" width="500" height="350"/>
  
  ##### 일정시간 뒤, 정보를 DB에 저장하는 부분

- 이를 통해 어느정도의 성능개선을 기대할 수 있었지만, 클라이언트에서의 많은 요청은 여전히 존재했습니다.
- 이 문제를 개선하기 위해 클라이언트에서도 저장요청에 CoolTime을 구현하기로 했습니다.
  
 <br>

   <img src="https://user-images.githubusercontent.com/38933716/140970462-30f5d8d7-5f7e-4a08-8629-26695366d0e7.png" width="500" height="350"/>

- isCoolTime 변수와 setTimeout을 이용해, 정보를 여러번 변경하더라도 1초 뒤에 하나의 요청만 하도록 변경하였습니다.

</br>
</br>

   <img src="https://user-images.githubusercontent.com/38933716/140970161-7f5f26cd-3c9d-41ba-b543-2536a8927034.png" width="400" height="400"/>

- 그 결과 이전과 똑같은 방법으로 테스트했을 때, 90번에 달하는 저장 요청이 9번의 버퍼저장과 4번의 DB쿼리 실행으로 줄어들었음에도 실시간 저장이 가능해졌습니다.


</br>
</br>


## 🛠 실행 방법

- 레포지토리를 clone 받거나, 압축을 해제한 후 npm install을 통해 환경 셋팅을 진행합니다.
- npm start를 통해 서버를 구동합니다.
- src 폴더에 .env 파일을 설정해서, 환경변수를 설정합니다.
- npm start로 서버를 구동시키고, npm test를 입력하면 단위 테스트가 가능합니다.
- [.env설정 노션 링크](https://www.notion.so/pre-onboarding15/8-3fe38392fa5841ebad5fa99306f0205a)
  - <details><summary><b>링크 접속불가 시 .env 파일 설정 방법</b></summary>

    ```
    PORT= '서버의 포트'
    JWT_SECERT= '원하는 시크릿코드'
    JWT_ALGO="HS256"
    ```


</details>


</br>
</br>


## 🗂 과제 확인 및 평가 API 명세서

- Postman을 활용하여 API 작동 테스트를 진행했습니다. 
- __배포된 서버 주소__ 및 자세한 API 명세는 아래에서 확인 가능합니다.
- [🗂 API Description Link](https://documenter.getpostman.com/view/15698210/UVC5F7jC)
- [![Run in Postman](https://run.pstmn.io/button.svg)](https://documenter.getpostman.com/view/15698210/UVC5F7jC) 을 클릭하여 웹브라우저 혹은 Postman 클라이언트에 콜렉션이 로드되면
   1. Variables 탭에서 서버 Host와 Port를 지정합니다. (기본값이 지정되어 있습니다.
   2. Variables 탭에서 테스트하는 동안 사용할 username과 password 그리고 newProjectName을 지정합니다. (기본값이 지정되어 있습니다.)
   3. 그후 우측 상단의 Run 버튼을 눌러 RUN ORDER 화면에 진입한 뒤 Run \[Collection Name\]을 클릭하면, 이상적인 상황에서의 테스트가 진행됩니다.
    <img src = "https://user-images.githubusercontent.com/32833404/140971968-5bbe1a9a-5dd4-43a4-80f5-54f36146cabf.jpg">
       
   4. 좌측의 Workspace 화면에서 해당 콜렉션과 그 요청에는 여러 이상적이지 않은 상황의 테스트에 대한 예시가 있습니다.</br>
    <img src ="https://user-images.githubusercontent.com/32833404/140972241-79be0bbf-d147-4a71-981c-d6b797b13901.png">

        **유의사항**
        *일부 요청의 경우 JWT를 필요로합니다. JWT는 로그인 과정에서 "Set-Cookie" 헤더를 통해 클라이언트가 스스로 관리하게끔 전달됩니다.
        *프로젝트 등록 과정에서 콜렉션 Variable의 projectId를 자동으로 수정합니다. 이를 원치 않는다면 해당 요청의 Test Script에서 지워주세요
 
- __게임 제작의 경우__ 다음과 같은 과정으로 __브라우저를 이용__ 하여 확인 가능합니다.
  1. 테스트 하기 전, api요청을 통해 프로젝트를 생성하고 프로젝트Id를 알고있어야 합니다.
     -  테스트를 위하여, [.env설정 노션 링크](https://www.notion.so/pre-onboarding15/750e9c9bd84f49bda72146b46a77923a)에 예시용 정보 및 주소를 적어놓았습니다.
  2.  아래 주소로 접속하여 로그인을 합니다.
      - 로그인 페이지 http://{{서버 주소}}/user/token
  
  3.  아래 주소로 접속하여 게임제작 및 퍼블리시를 테스트합니다.
       -  게임제작 페이지 http://{{서버 주소}}/projects/my/{{프로젝트Id}}?username={{유저네임}} 


</br>
</br>


## 😎 컨벤션 설정

- [👏🏻 협업을 위한 코드 컨벤션 설정하기](https://overcome-the-limits.tistory.com/entry/%ED%98%91%EC%97%85-%ED%98%91%EC%97%85%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%BD%94%EB%93%9C-%EC%BB%A8%EB%B2%A4%EC%85%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0)

- [👏🏻 Prettier, ESLint, Airbnb Style Guide로 코드 컨벤션  설정하기](https://overcome-the-limits.tistory.com/entry/%ED%98%91%EC%97%85-ESLint-Prettier-Airbnb-Style-Guide%EB%A1%9C-%EC%BD%94%EB%93%9C-%EC%BB%A8%EB%B2%A4%EC%85%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0?category=911197)

- [👏🏻 협업을 위한 git 커밋 컨벤션 설정하기](https://overcome-the-limits.tistory.com/entry/%ED%98%91%EC%97%85-%ED%98%91%EC%97%85%EC%9D%84-%EC%9C%84%ED%95%9C-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-git-%EC%BB%A4%EB%B0%8B%EC%BB%A8%EB%B2%A4%EC%85%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0?category=911197)

- [👏🏻 협업을 위한 Git Flow 설정하기](https://overcome-the-limits.tistory.com/entry/%ED%98%91%EC%97%85-%ED%98%91%EC%97%85%EC%9D%84-%EC%9C%84%ED%95%9C-Git-Flow-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0?category=911197)

- [👏🏻 협업을 위한 Git 명령어 가이드](https://overcome-the-limits.tistory.com/entry/%ED%98%91%EC%97%85-%ED%98%91%EC%97%85%EC%9D%84-%EC%9C%84%ED%95%9C-Git-%EB%AA%85%EB%A0%B9%EC%96%B4-%EA%B0%80%EC%9D%B4%EB%93%9C?category=911197) 

</br>
</br>


## 🛠 Dependencies

</br>

<div align=center>
<img src="https://user-images.githubusercontent.com/59385491/140954041-f43eed69-5bb5-4cac-a7c8-9a1c70afb649.png" height=850>
</div>


</br>
</br>


## 🌲 File Tree

</br>


```

📦src
 ┣ 📂bin
 ┃ ┗ 📜www.js
 ┃
 ┣ 📂configs
 ┃ ┣ 📜db.js
 ┃ ┣ 📜index.js
 ┃ ┗ 📜secretKey.js
 ┃
 ┣ 📂controllers
 ┃ ┣ 📜accountController.js
 ┃ ┣ 📜transactionController.js
 ┃ ┗ 📜userController.js
 ┃
 ┣ 📂globals
 ┃ ┣ 📜index.js
 ┃ ┣ 📜responseMessage.js
 ┃ ┣ 📜routes.js
 ┃ ┗ 📜statusCode.js
 ┃
 ┣ 📂libs
 ┃ ┣ 📜encryption.js
 ┃ ┗ 📜jwt.js
 ┃
 ┣ 📂middlewares
 ┃ ┗ 📜auth.js
 ┃
 ┣ 📂models
 ┃ ┣ 📜account.js
 ┃ ┣ 📜index.js
 ┃ ┣ 📜transaction.js
 ┃ ┗ 📜user.js
 ┃
 ┣ 📂routes
 ┃ ┣ 📜accountRouter.js
 ┃ ┣ 📜globalRouter.js
 ┃ ┣ 📜index.js
 ┃ ┗ 📜userRouter.js
 ┃
 ┣ 📂services
 ┃ ┣ 📜accountService.js
 ┃ ┣ 📜transactionService.js
 ┃ ┗ 📜userService.js
 ┃
 ┣ 📂test
 ┃ ┣ 📂data
 ┃ ┃ ┗ 📂dto
 ┃ ┃   ┗ 📜signup.json
 ┃ ┣ 📂unit
 ┃ ┃ ┗ 📂controllers
 ┃ ┃   ┗ 📂userController
 ┃ ┃     ┣ 📜postToken.test.js
 ┃ ┃     ┗ 📜postUser.test.js
 ┃
 ┣ 📂utils
 ┃ ┣ 📂errors
 ┃ ┃ ┣ 📜commonError.js
 ┃ ┃ ┣ 📜errors.js
 ┃ ┃ ┣ 📜transactionError.js
 ┃ ┃ ┗ 📜userError.js
 ┃ ┣ 📜index.js
 ┃ ┣ 📜logger.js
 ┃ ┗ 📜resFormatter.js
 ┣ 📜.env
 ┣ 📜.eslintrc.json
 ┣ 📜.gitignore
 ┣ 📜.prettierrc.json
 ┣ 📜app.js
 ┣ 📜database.db
 ┣ 📜package-lock.json
 ┗ 📜package.json

```
